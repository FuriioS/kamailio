From 1011b1a626bd69ecb0aa1a8804aa401d8c933bcf Mon Sep 17 00:00:00 2001
From: Victor Seva <linuxmaniac@torreviejawireless.org>
Date: Wed, 8 Jan 2014 14:39:28 +0100
Subject: [PATCH] modules_k/usrloc: add missing callid field to the update
 query at db_update_ucontact_instance function

---
 modules_k/usrloc/ucontact.c | 15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/modules_k/usrloc/ucontact.c b/modules_k/usrloc/ucontact.c
index c2462a7..ae0a08c 100644
--- a/modules_k/usrloc/ucontact.c
+++ b/modules_k/usrloc/ucontact.c
@@ -756,8 +756,8 @@ int db_update_ucontact_instance(ucontact_t* _c)
 	db_key_t keys1[4];
 	db_val_t vals1[4];
 
-	db_key_t keys2[13];
-	db_val_t vals2[13];
+	db_key_t keys2[14];
+	db_val_t vals2[14];
 	int nr_cols2;
 
 
@@ -784,8 +784,9 @@ int db_update_ucontact_instance(ucontact_t* _c)
 	keys2[8] = &sock_col;
 	keys2[9] = &methods_col;
 	keys2[10] = &last_mod_col;
-	keys2[11] = &ruid_col;
-	keys2[12] = &contact_col;
+	keys2[11] = &callid_col;
+	keys2[12] = &ruid_col;
+	keys2[13] = &contact_col;
 
 	vals1[0].type = DB1_STR;
 	vals1[0].nul = 0;
@@ -859,7 +860,11 @@ int db_update_ucontact_instance(ucontact_t* _c)
 	vals2[10].nul = 0;
 	vals2[10].val.time_val = _c->last_modified;
 
-	nr_cols2 = 11;
+	vals2[11].type = DB1_STR;
+	vals2[11].nul = 0;
+	vals2[11].val.str_val = _c->callid;
+
+	nr_cols2 = 12;
 	if(_c->ruid.len>0)
 	{
 		vals2[nr_cols2].type = DB1_STR;
-- 
1.8.5.2

